machine:
    # Setting timezone takes quite a bit of time
    # timezone:
    #     Europe/Stockholm
    ruby:
    python:
    pre:
    environment:
        PATH: $PATH:$HOME/.evm/bin:$HOME/.cask/bin
        EMACS: evm-emacs
        with_x_toolkit: n
        with_xml2: y
dependencies:
    pre:
        - sudo apt-get -qq update
        - sudo apt-get -qq install emacs24-nox libxpm-dev libncurses5-dev texinfo liblockfile-dev librsvg2-dev autoconf automake autotools-dev sharutils zlib1g-dev
        - sudo DEBIAN_FRONTEND=noninteractive apt-get -y -qq build-dep emacs24-nox || true
        - test -d ~/.evm/.git && git -C ~/.evm/ pull
        - test -d ~/.evm/.git || curl -fsSkL --retry 9 --retry-delay 9 https://raw.github.com/rejeep/evm/master/go | bash
        - mkdir -p ~/.evms
        - evm config path ~/.evms
        - evm use emacs-25.1         || evm install --use emacs-25.1
        - evm use emacs-24.5         || evm install emacs-24.5
        - evm use emacs-24.4         || evm install emacs-24.4
        - evm use emacs-24.3         || evm install emacs-24.3
        - evm use emacs-24.2         || evm install emacs-24.2
#        - evm use emacs-24.1         || evm install emacs-24.1
#        - evm use emacs-git-snapshot || evm install emacs-git-snapshot
        - evm use emacs-25.1
        - test -d ~/.cask/.git && git -C ~/.cask/ pull
        - test -d ~/.cask/.git || curl -fsSL https://raw.githubusercontent.com/cask/cask/master/go | python
    cache_directories:
        - "~/.evm"
        - "~/.evms"
        - "~/.cask"
test:
    override:
        - ci/evm-matrix.sh $CIRCLE_NODE_INDEX $CIRCLE_NODE_TOTAL:
            parallel: true
deployment:
    bitbucket:
        branch: master
        commands:
            - evm install --use emacs-25.1-travis
            - ci/publish.sh -c -u "Ola Nilsson" -e "ola.nilsson@gmail.com" buttercup-junit.el
